import{_ as s,c as a,o as l,a as e}from"./app.f6e6c401.js";const A=JSON.parse('{"title":"如何实现网页多标签tab通讯","description":"","frontmatter":{},"headers":[{"level":2,"title":"webSocket","slug":"websocket","link":"#websocket","children":[]},{"level":2,"title":"localStorage","slug":"localstorage","link":"#localstorage","children":[]},{"level":2,"title":"SharedWorker","slug":"sharedworker","link":"#sharedworker","children":[]},{"level":2,"title":"iframe 通讯","slug":"iframe-通讯","link":"#iframe-通讯","children":[]}],"relativePath":"interview/知识广度-从前端到全栈/10-如何实现网页多标签tab通讯.md"}'),o={name:"interview/知识广度-从前端到全栈/10-如何实现网页多标签tab通讯.md"},n=e(`<h1 id="如何实现网页多标签tab通讯" tabindex="-1">如何实现网页多标签tab通讯 <a class="header-anchor" href="#如何实现网页多标签tab通讯" aria-hidden="true">#</a></h1><blockquote><p>例如打开两个 chrome 标签，一个访问列表页，一个访问详情页。在详情页修改了标题，列表页也要同步过来。</p></blockquote><ul><li>webSocket 需要服务端参与，但不限制跨域</li><li>localStorage 简单易用</li><li>SharedWorker 本地调试不太方便，考虑浏览器兼容性</li></ul><h2 id="websocket" tabindex="-1">webSocket <a class="header-anchor" href="#websocket" aria-hidden="true">#</a></h2><p>通过 webSocket 多页面通讯</p><ul><li>无跨域限制。</li><li>需要服务端支持，成本高</li></ul><h2 id="localstorage" tabindex="-1">localStorage <a class="header-anchor" href="#localstorage" aria-hidden="true">#</a></h2><ul><li>同域的 A B 两个页面，可以通过 <code>localStorage </code>通讯</li><li>A 页面设置<code>localStorage</code></li><li>B 页面可监听到<code>localStorage</code> 值的修改</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// list 页面</span></span>
<span class="line"><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">storage</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">event</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">key</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">event</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">newValue</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">event</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">newValue</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// detail 页面</span></span>
<span class="line"><span style="color:#A6ACCD;">localStorage</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setItem</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">changeInfo</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">xxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="sharedworker" tabindex="-1">SharedWorker <a class="header-anchor" href="#sharedworker" aria-hidden="true">#</a></h2><blockquote><p>Javascript 是单线程的，而且和页面渲染线程互斥。所以，一些计算量大的操作会影响页面渲染。</p></blockquote><ul><li><code>SharedWorker</code> 是 <code>WebWorker</code> 的一种</li><li><code>WebWorker</code> 可开启子进程执行JS，但不能操作 DOM</li><li><code>SharedWorker</code> 可单独开启一个进程，用于同域页面通讯</li></ul><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank" rel="noreferrer">WebWorker</a> 可以 <code>new Worker(&#39;xxx.js&#39;)</code> 用来进行 JS 计算，并通过 <code>postMessage</code> 和 <code>onmessage</code> 和网页通讯。<br> 但这个 worker 是当前页面专有的，不得多个页面、iframe 共享。</p><p>PS：WebWorker 专用于 JS 计算，不支持 DOM 操作。</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/SharedWorker" target="_blank" rel="noreferrer">SharedWorker</a> 可以被同域的多个页面共享使用，也可以用于通讯。<br> 源码参考 msg-sharedWork-list.html 和 msg-sharedWork-detail.html 。注意，worker 中的日志需要 <code>chrome://inspect</code> 中打开控制台查看。</p><p>PS：注意浏览器兼容性，不支持 IE11</p><h2 id="iframe-通讯" tabindex="-1">iframe 通讯 <a class="header-anchor" href="#iframe-通讯" aria-hidden="true">#</a></h2><p>除了上述几个方法，iframe 通讯最常用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage" target="_blank" rel="noreferrer">window.postMessage</a> ，支持跨域。</p><p>通过 <code>window.postMessage</code> 发送消息。注意第二个参数，可以限制域名，如发送敏感信息，要限制域名。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 父页面向 iframe 发送消息</span></span>
<span class="line"><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">iframe1</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">contentWindow</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">postMessage</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// iframe 向父页面发送消息</span></span>
<span class="line"><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">parent</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">postMessage</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">world</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>可监听 <code>message</code> 来接收消息。可使用 <code>event.origin</code> 来判断信息来源是否合法，可选择不接受。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">message</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">event</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">origin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">event</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">origin</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// 通过 origin 判断是否来源合法</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">child received</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">event</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div>`,22),p=[n];function r(t,c,i,D,y,F){return l(),a("div",null,p)}const C=s(o,[["render",r]]);export{A as __pageData,C as default};
