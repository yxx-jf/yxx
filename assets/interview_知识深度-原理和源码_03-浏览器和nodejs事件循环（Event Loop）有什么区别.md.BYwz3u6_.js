import{_ as i,c as a,o as n,ae as l}from"./chunks/framework.DJWEhhqZ.js";const e="/yxx/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF.png",h="/yxx/nodejs%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF.png",g=JSON.parse('{"title":"浏览器和nodejs事件循环（Event Loop）有什么区别","description":"","frontmatter":{},"headers":[],"relativePath":"interview/知识深度-原理和源码/03-浏览器和nodejs事件循环（Event Loop）有什么区别.md","filePath":"interview/知识深度-原理和源码/03-浏览器和nodejs事件循环（Event Loop）有什么区别.md"}'),t={name:"interview/知识深度-原理和源码/03-浏览器和nodejs事件循环（Event Loop）有什么区别.md"};function k(p,s,d,E,o,r){return n(),a("div",null,[...s[0]||(s[0]=[l(`<h1 id="浏览器和nodejs事件循环-event-loop-有什么区别" tabindex="-1">浏览器和nodejs事件循环（Event Loop）有什么区别 <a class="header-anchor" href="#浏览器和nodejs事件循环-event-loop-有什么区别" aria-label="Permalink to &quot;浏览器和nodejs事件循环（Event Loop）有什么区别&quot;">​</a></h1><ul><li>浏览器和 <code>nodejs</code>的<code>event loop</code> 流程基本相同</li><li><code>nodejs</code> 宏任务和微任务分类型，有优先级</li></ul><h2 id="js的单线程和异步" tabindex="-1">JS的单线程和异步 <a class="header-anchor" href="#js的单线程和异步" aria-label="Permalink to &quot;JS的单线程和异步&quot;">​</a></h2><ul><li><code>JS</code>是单线程的(无论在浏览器还是<code>nodejs</code>)</li><li>浏览器中<code>JS</code>执行和<code>DOM</code>染共用一个线程</li><li>异步</li></ul><h2 id="异步的宏任务和微任务" tabindex="-1">异步的宏任务和微任务 <a class="header-anchor" href="#异步的宏任务和微任务" aria-label="Permalink to &quot;异步的宏任务和微任务&quot;">​</a></h2><ul><li>宏任务，如 <code>setTimeout</code> <code>setInterval</code> 网络请求</li><li>微任务，如 <code>promise</code> <code>async/await</code></li><li>微任务在下一轮 <code>DOM</code> 渲染之前执行，宏任务在之后执行</li><li>宏任务可以开始执行的必要条件是: 1. 微任务队列为空 2. DOM树没有检测到更新</li></ul><p>两者表面的区别：</p><p>第一，微任务比宏任务更快执行</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;start&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;timeout&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;promise.then&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;end&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>第二，微任务在 DOM 渲染前执行，而宏任务在 DOM 显示后（即真正显示到页面上，肉眼可见）执行</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;p&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">p.innerHTML </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;new paragraph&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">document.body.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appendChild</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;length----&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, list.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;start&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 渲染之后  宏任务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> list</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementsByTagName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;p&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;timeout----&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, list.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;阻塞&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 渲染之前  微任务</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> list</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementsByTagName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;p&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;promise.then----&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, list.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;阻塞&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;end&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h2 id="浏览器的事件循环-event-loop" tabindex="-1">浏览器的事件循环（Event Loop） <a class="header-anchor" href="#浏览器的事件循环-event-loop" aria-label="Permalink to &quot;浏览器的事件循环（Event Loop）&quot;">​</a></h2><p>主要的流程：</p><ul><li>执行 JS 同步代码（执行异步 API 时，异步先放在一个队列中，先不执行）</li><li>DOM 渲染</li><li>执行队列中的异步函数（执行异步 API 时，异步先放在一个队列中，先不执行）—— 异步中可能还嵌套异步</li><li>DOM 渲染</li><li>执行队列中的异步函数（执行异步 API 时，异步先放在一个队列中，先不执行）</li><li>DOM 渲染</li><li>……</li></ul><p><img src="`+e+'" alt="浏览器事件循环" data-fancybox="gallery"></p><h2 id="nodejs的异步" tabindex="-1">nodejs的异步 <a class="header-anchor" href="#nodejs的异步" aria-label="Permalink to &quot;nodejs的异步&quot;">​</a></h2><ul><li><code>Nodejs</code> 同样使用 <code>ES</code> 语法，也是单线程，也需要异步</li><li>异步任务也分:宏任务 + 微任务</li><li>但是，它的宏任务和微任务，分不同类型，有不同优先级</li></ul><h2 id="nodejs的宏任务和微任务" tabindex="-1">nodejs的宏任务和微任务 <a class="header-anchor" href="#nodejs的宏任务和微任务" aria-label="Permalink to &quot;nodejs的宏任务和微任务&quot;">​</a></h2><ul><li><code>setTimeout</code> <code>setInterval</code> —— 宏任务</li><li><code>promise</code> 和 <code>async/await</code> —— 微任务</li><li><code>process.nextTick</code> —— 微任务，<strong>但优先级最高</strong></li><li><code>setImmediate</code> —— 宏任务</li><li><code>I/O</code> 文件、网络 —— 宏任务</li><li><code>Socket</code> 连接：连接 <code>mysql</code> —— 宏任务</li></ul><h2 id="nodejs-宏任务类型和优先级" tabindex="-1">nodejs 宏任务类型和优先级 <a class="header-anchor" href="#nodejs-宏任务类型和优先级" aria-label="Permalink to &quot;nodejs 宏任务类型和优先级&quot;">​</a></h2><p>优先级从高到低：</p><ul><li><code>Timers</code> - <code>setTimeout</code> <code>setInterva</code></li><li><code>I/O</code> <code>callbacks</code> - 处理网络、流、TCP 的错误回调</li><li><code>Idle</code>,<code>prepare</code> - 闲置状态(nodejs 内部使用 )</li><li><code>Poll</code>轮询- 执行 <code>poll</code> 中的<code>I/O</code> 队列</li><li><code>Check</code> 检查- 存储 <code>setImmediate</code> 回调</li><li><code>Close callbacks</code> - 关闭回调，如 <code>socket.on(&#39;close&#39;)</code></li></ul><h2 id="nodejs-微任务类型和优先级" tabindex="-1">nodejs 微任务类型和优先级 <a class="header-anchor" href="#nodejs-微任务类型和优先级" aria-label="Permalink to &quot;nodejs 微任务类型和优先级&quot;">​</a></h2><ul><li>包括: <code>promise</code>,<code>async/await</code>,<code>process.nextTick</code></li><li>注意: <code>process.nextTick</code> 优先级最高</li></ul><h2 id="nodejs的事件循环-event-loop" tabindex="-1">nodejs的事件循环（Event Loop） <a class="header-anchor" href="#nodejs的事件循环-event-loop" aria-label="Permalink to &quot;nodejs的事件循环（Event Loop）&quot;">​</a></h2><ul><li>执行同步代码</li><li>执行微任务（process.nextTick 优先级更高）</li><li>按顺序执行6个类型的宏任务（每当开始之前都执行当前的微任务）</li><li>....</li></ul><p><img src="'+h+'" alt="nodejs事件循环" data-fancybox="gallery"></p>',27)])])}const y=i(t,[["render",k]]);export{g as __pageData,y as default};
