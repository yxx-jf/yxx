import{_ as s,o as a,c as n,O as l}from"./chunks/framework.1d9da8ae.js";const d=JSON.parse('{"title":"CentOS系统下Docker安装部署Strapi","description":"","frontmatter":{},"headers":[],"relativePath":"puzzle/Docker部署Strapi和mysql.md","filePath":"puzzle/Docker部署Strapi和mysql.md"}'),p={name:"puzzle/Docker部署Strapi和mysql.md"},o=l(`<h1 id="centos系统下docker安装部署strapi" tabindex="-1"><strong>CentOS系统下Docker安装部署Strapi</strong> <a class="header-anchor" href="#centos系统下docker安装部署strapi" aria-label="Permalink to &quot;**CentOS系统下Docker安装部署Strapi**&quot;">​</a></h1><h2 id="安装node" tabindex="-1"><strong>安装node</strong> <a class="header-anchor" href="#安装node" aria-label="Permalink to &quot;**安装node**&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>注意：CentOS如果版本过低 会导致高版本node使用不了，尽量使用高版本CentOS系统，推荐使用CentOS 8以上版本</p></div><p><strong>安装Node.js版本管理工具nvm</strong></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">bash</span></span></code></pre></div><pre><code>或者
</code></pre><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">wget</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-qO-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">bash</span></span></code></pre></div><pre><code>或者
</code></pre><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">clone</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">git://github.com/creationix/nvm.git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/nvm</span></span></code></pre></div><p><strong>验证安装</strong></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">command</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nvm</span></span></code></pre></div><p><strong>设置nvm自动运行</strong></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">source ~/nvm/nvm.sh</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/.bashrc</span></span>
<span class="line"><span style="color:#82AAFF;">source</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/.bashrc</span></span></code></pre></div><p><strong>安装Node.js版本</strong></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">nvm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">v18.17.1</span></span></code></pre></div><p><strong>切换Node.js版本</strong></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">nvm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">use</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">v18.17.1</span></span></code></pre></div><p><strong>查看版本</strong></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">node</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-v</span></span></code></pre></div><p><strong>下载 yarn 包管理</strong></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-sL</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://dl.yarnpkg.com/rpm/yarn.repo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tee</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/yum.repos.d/yarn.repo</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yarn</span></span></code></pre></div><h2 id="docker-部署mysql" tabindex="-1"><strong>Docker 部署mysql</strong> <a class="header-anchor" href="#docker-部署mysql" aria-label="Permalink to &quot;**Docker 部署mysql**&quot;">​</a></h2><p>1- 拉取镜像</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pull</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql:8.0.28</span></span></code></pre></div><p>2- 启动 mysql，将mysql中的数据挂载到本地</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./mysql/data:/var/lib/mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3306</span><span style="color:#C3E88D;">:3306</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--restart=always</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">MYSQL_ROOT_PASSWORD=root</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql:8.0.28</span></span></code></pre></div><p>3- 进入容器</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bash</span></span></code></pre></div><p>4- 登录mysql</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-u</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#输入前面启动 mysql 时的密码 root</span></span></code></pre></div><p>5- 添加远程登录用户</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">USER</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">yxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">%</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">IDENTIFIED</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">WITH</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql_native_password</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">BY</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">GRANT</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ALL</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">PRIVILEGES</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ON</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">.</span><span style="color:#A6ACCD;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">TO</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">yxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">%</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>记住上面部署mysql是添加远程登录的用户名和密码，我的文档是</p><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">用户名：yxx</span></span></code></pre></div><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">密码：root</span></span></code></pre></div><p>创建数据库(这里如果是数据库迁移的话，可以远程连接数据库，执行sql导入)</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 创建数据库，名称为 strapi</span></span>
<span class="line"><span style="color:#FFCB6B;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">database</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">strapi</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>记住这个位置我们创建的数据库的名称，我的文档是</p><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">strapi</span></span></code></pre></div><h2 id="创建-strapi-项目" tabindex="-1"><strong>创建 strapi 项目</strong> <a class="header-anchor" href="#创建-strapi-项目" aria-label="Permalink to &quot;**创建 strapi 项目**&quot;">​</a></h2><p>下载项目需要的依赖</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">update</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-g</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm</span></span></code></pre></div><p>1- 创建一个 strapi 项目</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">create-strapi-app@latest</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">my-strapi</span></span></code></pre></div><p>2- 运行项目</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">develop</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 根据弹出的地址进行访问</span></span></code></pre></div><p>3- 配置语言</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">vim</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./src/admin/app.js</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 文件中写入下面的内容</span></span>
<span class="line"><span style="color:#FFCB6B;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">config</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">locales:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">&#39;zh-Hans&#39;</span><span style="color:#FFCB6B;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">&#39;zh&#39;</span><span style="color:#FFCB6B;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  ],</span></span>
<span class="line"><span style="color:#A6ACCD;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bootstrap</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> (app) =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">console.log(app</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">config,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">bootstrap,</span></span>
<span class="line"><span style="color:#A6ACCD;">};</span></span></code></pre></div><p>重新编译运行</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">develop</span></span></code></pre></div><h2 id="制作-docker-镜像" tabindex="-1"><strong>制作 docker 镜像</strong> <a class="header-anchor" href="#制作-docker-镜像" aria-label="Permalink to &quot;**制作 docker 镜像**&quot;">​</a></h2><p>Dockerfile 脚本 将 dockerfile 和 .dockerignore 放在与项目 src 同级目录下</p><p>1- 编写 Dockerfile 脚本</p><p>官网参考：<a href="https://docs.strapi.io/dev-docs/installation/docker#development-dockerfile" target="_blank" rel="noreferrer">https://docs.strapi.io/dev-docs/installation/docker#development-dockerfile</a></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">FROM node:18-alpine</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN apk update &amp;&amp; apk add --no-cache build-base gcc autoconf automake zlib-dev libpng-dev nasm bash vips-dev</span></span>
<span class="line"><span style="color:#A6ACCD;">ARG NODE_ENV=development</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV NODE_ENV=\${NODE_ENV}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">WORKDIR /opt/app</span></span>
<span class="line"><span style="color:#A6ACCD;">COPY package*.json ./</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN npm update -g</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN npm install</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV PATH /opt/app/node_modules/.bin:$PATH</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">COPY . .</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN [&quot;npm&quot;, &quot;run&quot;, &quot;build&quot;]</span></span>
<span class="line"><span style="color:#A6ACCD;">EXPOSE 1337</span></span>
<span class="line"><span style="color:#A6ACCD;">CMD [&quot;npm&quot;, &quot;run&quot;, &quot;develop&quot;]</span></span></code></pre></div><p>2- 编写 .dockerignore 文件</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">vim</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.dockerignore</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 写入下面的内容</span></span>
<span class="line"><span style="color:#FFCB6B;">.tmp/</span></span>
<span class="line"><span style="color:#FFCB6B;">.cache/</span></span>
<span class="line"><span style="color:#FFCB6B;">.git/</span></span>
<span class="line"><span style="color:#FFCB6B;">build/</span></span>
<span class="line"><span style="color:#FFCB6B;">node_modules/</span></span>
<span class="line"><span style="color:#FFCB6B;">data</span></span></code></pre></div><p>3- build</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">or/strapi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span></span></code></pre></div><p>运行</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">strapi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--restart</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">always</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1337</span><span style="color:#C3E88D;">:1337</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">or/strapi</span></span></code></pre></div><h2 id="docker-compose" tabindex="-1"><strong>docker-compose</strong> <a class="header-anchor" href="#docker-compose" aria-label="Permalink to &quot;**docker-compose**&quot;">​</a></h2><p>1- 准备需要绑定挂在的文件</p><p>在/root/doker/目录下创建strapi文件夹</p><p>将下载的strapi项目里的config package.json package-lock.json src uploads文件复制进来</p><p>2- 准备需要挂载的 mysql 的数据</p><p>在/root/doker/目录下创建mysql文件夹</p><p>将下载的mysql项目复制进来</p><p>3- 编写 docker-compose.yml 脚本</p><div class="language-docker-compose.yml"><button title="Copy Code" class="copy"></button><span class="lang">docker-compose.yml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">version: &quot;3&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">services:</span></span>
<span class="line"><span style="color:#A6ACCD;">    strapi:</span></span>
<span class="line"><span style="color:#A6ACCD;">        container_name: or-strapi</span></span>
<span class="line"><span style="color:#A6ACCD;">        image: or/strapi</span></span>
<span class="line"><span style="color:#A6ACCD;">        environment:</span></span>
<span class="line"><span style="color:#A6ACCD;">            PUBLIC_URL: 192.168.157.143</span></span>
<span class="line"><span style="color:#A6ACCD;">            DATABASE_CLIENT: mysql</span></span>
<span class="line"><span style="color:#A6ACCD;">            DATABASE_HOST: 192.168.157.143</span></span>
<span class="line"><span style="color:#A6ACCD;">            DATABASE_PORT: 3306</span></span>
<span class="line"><span style="color:#A6ACCD;">            DATABASE_NAME: strapi</span></span>
<span class="line"><span style="color:#A6ACCD;">            DATABASE_USERNAME: yxx</span></span>
<span class="line"><span style="color:#A6ACCD;">            DATABASE_PASSWORD: root</span></span>
<span class="line"><span style="color:#A6ACCD;">        ports:</span></span>
<span class="line"><span style="color:#A6ACCD;">            - &quot;1337:1337&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        networks:</span></span>
<span class="line"><span style="color:#A6ACCD;">            - strapi</span></span>
<span class="line"><span style="color:#A6ACCD;">        depends_on:</span></span>
<span class="line"><span style="color:#A6ACCD;">            - mysql</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    mysql:</span></span>
<span class="line"><span style="color:#A6ACCD;">        container_name: or-mysql</span></span>
<span class="line"><span style="color:#A6ACCD;">        image: mysql:8.0.28</span></span>
<span class="line"><span style="color:#A6ACCD;">        environment:</span></span>
<span class="line"><span style="color:#A6ACCD;">            MYSQL_ROOT_PASSWORD: root</span></span>
<span class="line"><span style="color:#A6ACCD;">            MYSQL_USER: yxx</span></span>
<span class="line"><span style="color:#A6ACCD;">            MYSQL_PASSWORD: root</span></span>
<span class="line"><span style="color:#A6ACCD;">            MYSQL_DATABASE: strapi</span></span>
<span class="line"><span style="color:#A6ACCD;">        volumes:</span></span>
<span class="line"><span style="color:#A6ACCD;">            - ./mysql/data:/var/lib/mysql</span></span>
<span class="line"><span style="color:#A6ACCD;">        ports:</span></span>
<span class="line"><span style="color:#A6ACCD;">            - &quot;3306:3306&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        networks:</span></span>
<span class="line"><span style="color:#A6ACCD;">            - strapi</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">volumes:</span></span>
<span class="line"><span style="color:#A6ACCD;">    strapi-data:</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">networks:</span></span>
<span class="line"><span style="color:#A6ACCD;">    strapi:</span></span>
<span class="line"><span style="color:#A6ACCD;">        driver: bridge</span></span></code></pre></div><p>/root/docker/目录下所有的准备文件如下 docker-compose.yml、mysql、strapi</p><p>运行，运行前需要删除我们 dockerfile 脚本中运行的镜像，然后执行下面的命令</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker-compose</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">up</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span></span></code></pre></div>`,73),e=[o];function t(c,r,C,y,i,A){return a(),n("div",null,e)}const h=s(p,[["render",t]]);export{d as __pageData,h as default};
