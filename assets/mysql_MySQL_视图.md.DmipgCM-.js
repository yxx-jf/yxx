import{_ as e,c as s,o as t,ae as l}from"./chunks/framework.DJWEhhqZ.js";const u=JSON.parse('{"title":"视图","description":"","frontmatter":{},"headers":[],"relativePath":"mysql/MySQL/视图.md","filePath":"mysql/MySQL/视图.md"}'),i={name:"mysql/MySQL/视图.md"};function n(p,a,o,d,c,r){return t(),s("div",null,[...a[0]||(a[0]=[l(`<h1 id="视图" tabindex="-1">视图 <a class="header-anchor" href="#视图" aria-label="Permalink to &quot;视图&quot;">​</a></h1><blockquote><p>视图是一个虚拟的表，可以用来简化复杂的SQL操作。</p></blockquote><h2 id="什么是视图" tabindex="-1">什么是视图 <a class="header-anchor" href="#什么是视图" aria-label="Permalink to &quot;什么是视图&quot;">​</a></h2><p>视图是对若干张基本表的引用，一张虚表，查询语句执行的结果，不存储具体的数据（基本表数据发生了改变，视图也会跟着改变）；</p><p>数据库视图与数据库表类似，它由行和列组成，，进行增删改查操作(PS:增删改操作有条件限制)；</p><h2 id="视图优点与缺点" tabindex="-1">视图优点与缺点 <a class="header-anchor" href="#视图优点与缺点" aria-label="Permalink to &quot;视图优点与缺点&quot;">​</a></h2><h3 id="视图的优点" tabindex="-1">视图的优点 <a class="header-anchor" href="#视图的优点" aria-label="Permalink to &quot;视图的优点&quot;">​</a></h3><ul><li>数据库视图允许简化复杂查询：数据库视图由与许多基础表相关联的SQL语句定义。 您可以使用数据库视图来隐藏最终用户和外部应用程序的基础表的复杂性。 通过数据库视图，您只需使用简单的SQL语句，而不是使用具有多个连接的复杂的SQL语句。</li><li>数据库视图有助于限制对特定用户的数据访问。 您可能不希望所有用户都可以查询敏感数据的子集。可以使用数据库视图将非敏感数据仅显示给特定用户组。</li><li>数据库视图提供额外的安全层。 安全是任何关系数据库管理系统的重要组成部分。 数据库视图为数据库管理系统提供了额外的安全性。 数据库视图允许您创建只读视图，以将只读数据公开给特定用户。 用户只能以只读视图检索数据，但无法更新。</li><li>数据库视图启用计算列。 数据库表不应该具有计算列，但数据库视图可以这样。</li><li>数据库视图实现向后兼容。 假设你有一个中央数据库，许多应用程序正在使用它。 有一天，您决定重新设计数据库以适应新的业务需求。删除一些表并创建新的表，并且不希望更改影响其他应用程序。在这种情况下，可以创建与将要删除的旧表相同的模式的数据库视图。</li></ul><h3 id="视图的缺点" tabindex="-1">视图的缺点 <a class="header-anchor" href="#视图的缺点" aria-label="Permalink to &quot;视图的缺点&quot;">​</a></h3><p>数据库视图有几个缺点：</p><ul><li>性能：从数据库视图查询数据可能会很慢，特别是如果视图是基于其他视图创建的。</li><li>表依赖关系：将根据数据库的基础表创建一个视图。每当更改与其相关联的表的结构时，都必须更改视图。</li></ul><h2 id="视图基本使用" tabindex="-1">视图基本使用 <a class="header-anchor" href="#视图基本使用" aria-label="Permalink to &quot;视图基本使用&quot;">​</a></h2><h3 id="视图管理语句" tabindex="-1">视图管理语句 <a class="header-anchor" href="#视图管理语句" aria-label="Permalink to &quot;视图管理语句&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:left;">语句</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">show tables;</td><td style="text-align:left;">查看视图/表</td></tr><tr><td style="text-align:left;">desc 表名/视图;</td><td style="text-align:left;">查看视图/表结构</td></tr><tr><td style="text-align:left;">show create table 表名;</td><td style="text-align:left;">查看建表过程</td></tr><tr><td style="text-align:left;">show create view 视图名;</td><td style="text-align:left;">查看建立视图过程</td></tr><tr><td style="text-align:left;">create table 表名 (列1 列类型 [列属性 默认值])</td><td style="text-align:left;">创建表</td></tr><tr><td style="text-align:left;">create view 视图名 as select ...</td><td style="text-align:left;">创建视图</td></tr><tr><td style="text-align:left;">alter view 视图名 as select ....</td><td style="text-align:left;">修改视图</td></tr><tr><td style="text-align:left;">drop table 表名</td><td style="text-align:left;">删除表</td></tr><tr><td style="text-align:left;">drop view 视图名</td><td style="text-align:left;">删除视图</td></tr></tbody></table><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 查询数据库中表信息</span></span>
<span class="line"><span>show table status</span></span>
<span class="line"><span># 如果信息太多，可以加 \\G竖着显示</span></span>
<span class="line"><span>show table status \\G</span></span></code></pre></div><p>通过查询表的详细信息，可以区分是否为视图，如果视图 Comment:VIEW 不是视图Comment:</p><p>查看某张表的详细信息</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>show table status where name=&quot;表名&quot;</span></span></code></pre></div><h3 id="创建视图" tabindex="-1">创建视图 <a class="header-anchor" href="#创建视图" aria-label="Permalink to &quot;创建视图&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>create view 视图名称 as (select 语句....)</span></span></code></pre></div><p>例如：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>create view sheng as select goods_id,goods_name,(market_price-shop_price) as sheng from goods ;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>select * from sheng;</span></span></code></pre></div><p>这个sheng视图 就是上一条select的结果集，可以像一张表一样使用它。</p><h3 id="视图修改、删除" tabindex="-1">视图修改、删除 <a class="header-anchor" href="#视图修改、删除" aria-label="Permalink to &quot;视图修改、删除&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>create view vuser as select uid,name from user;</span></span>
<span class="line"><span>select * from user;</span></span></code></pre></div><p>1.将原表 user中的数据修改一下</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>update user set name=&quot;king&quot; where uid=4</span></span></code></pre></div><p>2.查询vuser 视图中的数据，查询数据是否有变化</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>select * from vuser</span></span></code></pre></div><p>结论：vuser查询到的是修改后的内容&lt;因为视图就是物理表经过某个运行(select )得到的一个投影，真实表发生变化，投影也随之改变。</p><p>3.我们修改vuser 视图中的数据会发生什么？</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>update vuser set name =&quot;tom&quot; where uid =4</span></span></code></pre></div><p>最终效果user表和vuser视图的数据都修改成功了</p><p>4.修改视图中的虚拟列</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>select * from pingjun;</span></span></code></pre></div><p>视图pingjun中的pj列数据能否修改成功？</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>update pingjun set pj=100 where cat_id=15</span></span></code></pre></div><p>报错：pingjun表的pj字段不能修改</p><p>逻辑上有错误，我们将一个栏目下平均价格给改了，那个这个栏目下那么多商品，这些商品的价格又该是多少？</p><p>如果视图的每一行是与物理表一一对应，它俩有且只有一个相互对应的字段，就像数学上的可逆函数，如果是这样就可以相互影响修改</p><p>如果视图的某一行是由物理表经过计算得到的结果，视图则是不能更改的，因为它映射到物理表上有多行，不知道该修改哪里。</p><h3 id="可更新视图" tabindex="-1">可更新视图 <a class="header-anchor" href="#可更新视图" aria-label="Permalink to &quot;可更新视图&quot;">​</a></h3><p>在MySQL中，视图不仅是可查询的，而且是可更新的。这意味着您可以使用INSERT或UPDATE语句通过可更新视图插入或更新基表的行。 另外，您可以使用DELETE语句通过视图删除底层表的行。</p><p>但是，要创建可更新视图，定义视图的SELECT语句不能包含以下任何元素：</p><ul><li>聚合函数，如：MIN，MAX，SUM，AVG，COUNT等。</li><li>DISTINCT子句</li><li>GROUP BY子句</li><li>HAVING子句</li><li>UNION或UNION ALL子句</li><li>左连接或外连接。</li><li>SELECT子句中的子查询或引用该表的WHERE子句中的子查询出现在FROM子句中。</li><li>引用FROM子句中的不可更新视图</li><li>仅引用文字值</li><li>对基表的任何列的多次引用</li></ul><p>如果使用TEMPTABLE算法创建视图，则无法更新视图。</p><h2 id="视图使用场合" tabindex="-1">视图使用场合 <a class="header-anchor" href="#视图使用场合" aria-label="Permalink to &quot;视图使用场合&quot;">​</a></h2><h3 id="权限控制" tabindex="-1">权限控制 <a class="header-anchor" href="#权限控制" aria-label="Permalink to &quot;权限控制&quot;">​</a></h3><p>比如：某几列允许用户查询到，其他列不允许查询</p><p>通过视图，开放其中一列或几列起到权限控制的作用。</p><p>例如我们只让用户查询到goods表中goods_id,goods_name,shop_price</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>create view goods2 as select goods_id,goods_name,shop_price from goods</span></span>
<span class="line"><span></span></span>
<span class="line"><span>select * from goods2</span></span>
<span class="line"><span># 任你如何查询goods2 表也无法得到market_price这一列</span></span></code></pre></div><h3 id="简化复杂的查询" tabindex="-1">简化复杂的查询 <a class="header-anchor" href="#简化复杂的查询" aria-label="Permalink to &quot;简化复杂的查询&quot;">​</a></h3><p>select 嵌套select 查询 select * from (select ....) 我们可以先将内层select语句查询结果转为视图，再通过视图查询到我们想要的内容。</p><p>例如查询每个栏目下商品的平均价格，并按照平均价格 查出前三高的商品的栏目</p><ol><li>查询每个栏目下的平均价格</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>select cat_id,avg(shop_price) from goods group by cat_id</span></span></code></pre></div><ol><li>对每个栏目下的平均价格进行desc排序，并取出前三高</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>select * from (select cat_id,avg(shop_price) as pj from goods group by cat_id) as tmp order by pj desc limit 0,3</span></span></code></pre></div><ol><li>通过视图简化以上的sql</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>create view pingjun as select cat_id,avg(shop_price) as pj from goods group by cat_id</span></span>
<span class="line"><span></span></span>
<span class="line"><span>select * from pingjun order by pj desc limit 0,3</span></span></code></pre></div>`,61)])])}const g=e(i,[["render",n]]);export{u as __pageData,g as default};
