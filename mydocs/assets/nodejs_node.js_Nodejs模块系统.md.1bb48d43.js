import{_ as s,c as n,o as a,a as l}from"./app.ad3b77f8.js";const C=JSON.parse('{"title":"Nodejs模块系统","description":"","frontmatter":{},"headers":[{"level":2,"title":"为什么需要模块化","slug":"为什么需要模块化","link":"#为什么需要模块化","children":[]},{"level":2,"title":"什么是模块","slug":"什么是模块","link":"#什么是模块","children":[]},{"level":2,"title":"模块分类","slug":"模块分类","link":"#模块分类","children":[]},{"level":2,"title":"模块使用","slug":"模块使用","link":"#模块使用","children":[]},{"level":2,"title":"模块其他","slug":"模块其他","link":"#模块其他","children":[]},{"level":2,"title":"Nodejs模块原理","slug":"nodejs模块原理","link":"#nodejs模块原理","children":[]},{"level":2,"title":"Nodejs包","slug":"nodejs包","link":"#nodejs包","children":[]},{"level":2,"title":"NPM使用","slug":"npm使用","link":"#npm使用","children":[]}],"relativePath":"nodejs/node.js/Nodejs模块系统.md"}'),t={name:"nodejs/node.js/Nodejs模块系统.md"},o=l(`<h1 id="nodejs模块系统" tabindex="-1">Nodejs模块系统 <a class="header-anchor" href="#nodejs模块系统" aria-hidden="true">#</a></h1><blockquote><p>模块化是指解决一个复杂问题时自顶向下逐层把系统划分成若干模块的过程，有多种属性，分别反映其内部特性。</p><p>模块化用来分割，组织和打包软件。每个模块完成一个特定的子功能，所有的模块按某种方法组装起来，成为一个整体，完成整个系统所要求的功能。</p><p>模块具有以下几种基本属性：接口、功能、逻辑、状态，功能、状态与接口反映模块的外部特性，逻辑反映它的内部特性。</p></blockquote><h2 id="为什么需要模块化" tabindex="-1">为什么需要模块化 <a class="header-anchor" href="#为什么需要模块化" aria-hidden="true">#</a></h2><blockquote><p>模块化可以使你的代码低耦合，功能模块直接不相互影响。</p></blockquote><p>模块化编程解决问题：</p><ol><li>可维护性：每个模块都是单独定义的，之间相互独立。模块尽可能的需要和外部撇清关系，方便我们独立的对其进行维护与改造。维护一个模块比在全局中修改逻辑判断要好的多。</li><li>命名冲突：为了避免在JavaScript中的全局污染，我们通过模块化的方式利用函数作用域来构建命名空间，避免命名冲突。</li><li>可复用性（可分治性）：虽然粘贴复制很简单，但是要考虑到我们之后的维护以及迭代。</li><li>文件依赖</li></ol><h2 id="什么是模块" tabindex="-1">什么是模块 <a class="header-anchor" href="#什么是模块" aria-hidden="true">#</a></h2><blockquote><p>为了让Nodejs的文件可以相互调用，Nodejs提供了一个简单的模块系统。Node.js是基于CommonJS规范进行模块化管理的，模块化是面对复杂的业务场景不可或缺的工具。</p></blockquote><p>模块是Node.js 应用程序的基本组成部分，<em><strong>文件和模块是一一对应的</strong></em>。换言之，<strong>一个 Nodejs 文件就是一个模块</strong>，这个文件可能是JavaScript 代码、JSON 或者编译过的C/C++ 扩展。</p><p>在 CommonJS 的规范中，每个 JavaScript 文件就是一个独立的模块上下文（module context），在这个上下文中默认创建的属性都是私有的。也就是说，在一个文件定义的变量（还包括函数和类），都是私有的，对其他文件是不可见的。</p><p>在当前模块下定义的所有的变量/函数，都是属于这个模块的，如果想要定义全局变量，必须通过global.定义。那么在模块下定义的变量它的作用范围只是当前模块。而通过global定义的变量，那么它具有全局的作用范围。</p><h2 id="模块分类" tabindex="-1">模块分类 <a class="header-anchor" href="#模块分类" aria-hidden="true">#</a></h2><p>在Nodejs中常见的模块主要有两种类型，即：<strong>内置(原生、核心)模块</strong> 和 <strong>文件模块</strong>。</p><table><thead><tr><th style="text-align:center;">模块类型</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:center;">内置模块</td><td style="text-align:left;">即Node.jsAPI提供的内置模块(也叫核心模块)，原生模块在启动时已经被加载。(如：os模块、http模块、fs模块、buffer模块、path模块等)</td></tr><tr><td style="text-align:center;">第三方模块</td><td style="text-align:left;">为动态加载模块，加载文件模块的主要由原生模块module来实现和完成。原生模块在启动时已经被加载，而文件模块则需要通过调用Node.js的require方法来实现加载。</td></tr></tbody></table><p><strong>第三方模块类型</strong></p><blockquote><p>在第三方模块中，又分为3类模块。这三类文件模块以后缀来区分，Node.js会根据后缀名来决定加载方法。</p></blockquote><table><thead><tr><th>类型</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td>.js</td><td style="text-align:left;">Javascript模块，通过fs模块同步读取js文件并编译执行。</td></tr><tr><td>.node</td><td style="text-align:left;">C/C++ 模块，通过C/C++进行编写的Addon。通过dlopen方法进行加载。</td></tr><tr><td>.json</td><td style="text-align:left;">json 模块，读取文件，调用JSON.parse解析加载。</td></tr></tbody></table><ul><li>调用内置模块</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//调用内置模块不需要指定路径</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> http </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><ul><li>调用第三方模块</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//调用第三方模块必须指定路径，否则会报错</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> sum </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./sum.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="模块使用" tabindex="-1">模块使用 <a class="header-anchor" href="#模块使用" aria-hidden="true">#</a></h2><ul><li>使用 <code>module.exports</code> 对象或<code>exports</code>导出模块对外接口</li><li>使用 <code>require</code> 加载模块</li></ul><p><strong>加载模块</strong></p><p>通过 <code>require</code> 方法来同步加载所要依赖的其他模块。</p><p><code>require</code>方法接受以下几种参数的传递：</p><table><thead><tr><th style="text-align:left;">名称</th><th style="text-align:left;">示例</th></tr></thead><tbody><tr><td style="text-align:left;">原生模块</td><td style="text-align:left;">如<code>http</code>、<code>fs</code>、<code>path</code>等</td></tr><tr><td style="text-align:left;">相对路径第三方模块</td><td style="text-align:left;">如<code>./mod</code>或<code>../mod</code></td></tr><tr><td style="text-align:left;">绝对路径第三方模块</td><td style="text-align:left;">如<code>/pathtomodule/mod</code></td></tr><tr><td style="text-align:left;">非原生第三方模块</td><td style="text-align:left;">如<code>mod</code></td></tr></tbody></table><p><code>require</code>方法用于在当前模块中加载和使用别的模块，传入一个模块名，返回一个模块导出对象。模块名可使用相对路径（以<code>./</code>开头），或者是绝对路径（以<code>/</code>或<code>C:</code>之类的盘符开头）。另外，模块名中的<code>.js</code>扩展名可以省略。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> foo1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./foo</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> foo2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./foo.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> foo3 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/home/user/foo</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> foo4 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/home/user/foo.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//foo1 ~ foo4 中保存的是同一个模块的导出对象。</span></span>
<span class="line"></span></code></pre></div><p><strong>exports 导出模块</strong></p><p><code>exports</code>对象是当前模块的导出对象，用于导出模块公有方法和属性。别的模块通过<code>require</code>函数使用当前模块时得到的就是当前模块的<code>exports</code>对象。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// sum.js</span></span>
<span class="line"><span style="color:#89DDFF;">exports.</span><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">b</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// main.js</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> m </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./sum</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> num </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> m</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">20</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(num)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p><strong>module.exports 导出模块</strong></p><p>通过<code>module</code>对象可以访问到当前模块的一些相关信息，但最多的用途是替换当前模块导出对象。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//sum.js</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sum</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">b</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports=</span><span style="color:#A6ACCD;"> sum</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//main.js</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> sum </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./sum</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">20</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">// 30</span></span>
<span class="line"></span></code></pre></div><p>module的其它API: 每一个js文件都是一个模块，每一个模块都有一个对象这个对象的可以通过module访问到，该对象上保存了一些我们当前模块的状态：</p><table><thead><tr><th>API</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td><a href="http://module.id" target="_blank" rel="noreferrer">module.id</a></td><td style="text-align:left;">模块的ID,通常是当前模块文件路径，含文件名</td></tr><tr><td>module.filename</td><td style="text-align:left;">当前模块文件路径，含文件名</td></tr><tr><td>module.loaded</td><td style="text-align:left;">判断模块当前是否已加载</td></tr><tr><td>module.parent</td><td style="text-align:left;">加载当前脚本的模块对象。</td></tr><tr><td>module.children</td><td style="text-align:left;">当前模块加载的模块对象集合，是一个数组</td></tr></tbody></table><p><strong>exports和module.exports 自我理解</strong></p><ul><li><p>module.exports是将一个空对象{}赋值给module.exports ： <code>var module.exports={}</code></p></li><li><p>exports是将module.exports的值赋给exports ： <code>var exports=module.exports={}</code></p></li><li><p>exports === module.exports</p></li><li><p><code>exports.n=1</code>/<code>module.exports.n=1</code>其实修改的是空对象{}</p></li><li><p>exports的值基于module.exports也就是空对象{}的值，module.exports的值基于空对象{}的值。</p></li></ul><h2 id="模块其他" tabindex="-1">模块其他 <a class="header-anchor" href="#模块其他" aria-hidden="true">#</a></h2><p><strong>模块初始化</strong></p><p>一个模块中的JS代码仅在模块第一次被使用时执行一次，并在执行过程中初始化模块的导出对象。之后，缓存起来的导出对象被重复利用。</p><p><strong>主模块</strong></p><p>通过命令行参数传递给NodeJS以启动程序的模块被称为主模块。主模块负责调度组成整个程序的其它模块完成工作。例如通过以下命令启动程序时，main.js就是主模块。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">node main</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js</span></span>
<span class="line"></span></code></pre></div><p><strong>变量</strong></p><p><code>__filename</code>表示当前正在执行的脚本的文件名。输出文件所在位置的绝对路径</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(__filename)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 输出: /Users/houningzhou/Web/Nodejs/global/test.js</span></span>
<span class="line"></span></code></pre></div><p><code>__dirname</code>表示当前执行脚本所在的目录</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(__dirname)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 输出: /Users/houningzhou/Web/Nodejs/global</span></span>
<span class="line"></span></code></pre></div><p><strong>node_modules目录</strong></p><blockquote><p>NodeJS定义了一个特殊的<code>node_modules</code>目录用于存放模块。</p></blockquote><p>如果传给 <code>require()</code> 的模块标识符不是核心模块，并且不以 <code>&#39;/&#39;</code>、<code>&#39;../&#39;</code> 或 <code>&#39;./&#39;</code> 开头，则 Node.js 从当前模块的父目录开始，并添加 <code>/node_modules</code>，并尝试加载该位置的模块。</p><p>例如某个模块的绝对路径是<code>/home/user/hello.js</code>，在该模块中使用<code>require(&#39;foo/bar&#39;)</code>方式加载模块时，则NodeJS依次尝试使用以下路径。</p><p>从当前文件目录开始查找node_modules目录；然后依次进入父目录，查找父目录下的node_modules目录；依次迭代，直到根目录下的node_modules目录。</p><h2 id="nodejs模块原理" tabindex="-1">Nodejs模块原理 <a class="header-anchor" href="#nodejs模块原理" aria-hidden="true">#</a></h2><p><strong>模块加载原理</strong></p><p><code>require(&#39;./sum.js&#39;)</code>一般执行了五个步骤：</p><p>简单概括下这五个步骤</p><table><thead><tr><th style="text-align:left;">名称</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">Resolving</td><td style="text-align:left;">找到待引用的目标模块，并生成绝对路径。</td></tr><tr><td style="text-align:left;">Loading</td><td style="text-align:left;">判断待引用的模块内容是什么类型，它可能是.json文件、.js文件或者.node文件。</td></tr><tr><td style="text-align:left;">Wrapping</td><td style="text-align:left;">顾名思义，包装被引用的模块。通过包装，让模块具有私有作用域。</td></tr><tr><td style="text-align:left;">Evaluating</td><td style="text-align:left;">被加载的模块被真正的解析和处理执行。</td></tr><tr><td style="text-align:left;">Caching</td><td style="text-align:left;">缓存模块，这让我们在引入相同模块时，不用再重复上述步骤。</td></tr></tbody></table><p>按照模块的分类，按照以下顺序进行优先加载：</p><table><thead><tr><th style="text-align:left;">名称</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">系统缓存</td><td style="text-align:left;">模块被执行之后会会进行缓存，首先是先进行缓存加载，判断缓存中是否有值。</td></tr><tr><td style="text-align:left;">系统模块</td><td style="text-align:left;">也就是原生模块，这个优先级仅次于缓存加载，部分核心模块已经被编译成二进制，省略了 路径分析、文件定位，直接加载到了内存中，系统模块定义在 Node.js 源码的 lib 目录下，可以去查看。</td></tr><tr><td style="text-align:left;">文件模块</td><td style="text-align:left;">优先加载 <code>.</code>、<code>..</code>、<code>/</code> 开头的，如果文件没有加上扩展名，会依次按照 .js、.json、.node 进行扩展名补足尝试，那么在尝试的过程中也是以同步阻塞模式来判断文件是否存在，从性能优化的角度来看待，.json、.node最好还是加上文件的扩展名。</td></tr><tr><td style="text-align:left;">目录模块</td><td style="text-align:left;">这种情况发生在文件模块加载过程中，也没有找到，但是发现是一个目录的情况，这个时候会将这个目录当作一个 包 来处理，Node 这块采用了 Commonjs 规范，先会在项目根目录查找 package.json 文件，取出文件中定义的 main 属性 (<code>&quot;main&quot;: &quot;lib/hello.js&quot;</code>) 描述的入口文件进行加载，也没加载到，则会抛出默认错误: <code>Error: Cannot find module &#39;lib/hello.js&#39;</code></td></tr><tr><td style="text-align:left;">node_modules目录</td><td style="text-align:left;">对于系统模块、路径文件模块都找不到，Node.js 会从当前模块的父目录进行查找，直到系统的根目录</td></tr></tbody></table><p><strong>模块的工作原理</strong></p><p>Nodejs 每个文件都是一个模块，模块内的变量都是局部变量，不会污染全局变量，在执行模块代码之前，Nodejs 会使用一个如下的函数封装器将模块封装：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">exports</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">require</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">module</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">__filename</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">__dirname</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 模块的代码实际上在这里</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>通过这样做，Node.js 实现了以下几点：</p><ul><li>它将顶层变量（用 <code>var</code>、<code>const</code> 或 <code>let</code> 定义）保持在模块而不是全局对象的范围内。</li><li>它有助于提供一些实际特定于模块的全局变量，例如： <ul><li><code>module</code> 和 <code>exports</code> 对象，实现者可以用来从模块中导出值。</li><li>便利变量 <code>__filename</code> 和 <code>__dirname</code>，包含模块的绝对文件名和目录路径。</li></ul></li></ul><table><thead><tr><th style="text-align:left;">名称</th><th style="text-align:left;">类型</th><th style="text-align:left;">介绍</th></tr></thead><tbody><tr><td style="text-align:left;"><code>require</code></td><td style="text-align:left;">函数</td><td style="text-align:left;">用于加载模块，只能在模块中使用</td></tr><tr><td style="text-align:left;"><code>module</code></td><td style="text-align:left;">对象</td><td style="text-align:left;">对当前模块的一个引用</td></tr><tr><td style="text-align:left;"><code>exports</code></td><td style="text-align:left;">对象</td><td style="text-align:left;"><code>exports</code>是对<code>module.exports</code>的一个引用</td></tr><tr><td style="text-align:left;"><code>__filename</code></td><td style="text-align:left;">变量</td><td style="text-align:left;">返回当前脚本执行文件路径(含名称)</td></tr><tr><td style="text-align:left;"><code>__dirname</code></td><td style="text-align:left;">变量</td><td style="text-align:left;">返回当前脚本执行目录</td></tr></tbody></table><h2 id="nodejs包" tabindex="-1">Nodejs包 <a class="header-anchor" href="#nodejs包" aria-hidden="true">#</a></h2><p>把由多个子模块组成的大模块称做<strong>包</strong>(package)，并把所有子模块放在同一个目录里。</p><p><strong>自定义包</strong></p><p>在组成一个包的所有子模块中，需要有一个入口模块，入口模块的导出对象被作为包的导出对象。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;"># 目录：</span><span style="color:#FFCB6B;">d</span><span style="color:#89DDFF;">:/</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">calc</span><span style="color:#89DDFF;">/</span></span>
<span class="line"><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">calc</span></span>
<span class="line"><span style="color:#A6ACCD;">    sum</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js            </span><span style="color:#676E95;font-style:italic;">//加法</span></span>
<span class="line"><span style="color:#A6ACCD;">    subtraction</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js    </span><span style="color:#676E95;font-style:italic;">//减法</span></span>
<span class="line"><span style="color:#A6ACCD;">    multiplication</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js </span><span style="color:#676E95;font-style:italic;">//乘法</span></span>
<span class="line"><span style="color:#A6ACCD;">    division</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js       </span><span style="color:#676E95;font-style:italic;">//除法</span></span>
<span class="line"><span style="color:#A6ACCD;">    main</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js           </span><span style="color:#676E95;font-style:italic;">//主模块 入口模块</span></span>
<span class="line"></span></code></pre></div><p>calc目录定义了一个包，其中包含了4个子模块，main.js作为入口模块。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> sum </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./sum.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> subtraction </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">reuqire</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./subtraction.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> multiplication </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./multiplication.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> division </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./division.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">calc</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">tag</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">b</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">switch</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">tag</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">+</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">sum</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">b</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">-</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">subtraction</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">b</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">multiplication</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">b</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">division</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">b</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> calc</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>使用自定义包</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//d:/node/use.js</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> calc </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./calc/main.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">clac</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">+</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p><strong>包配置文件</strong></p><p>包配置文件是一个JSON格式的文件 <code>package.json</code> , 位于包的根目录下, 是包的重要组成部分。</p><p>如果想自定义入口模块的文件名和存放位置，就需要在包目录下包含一个 package.json 文件，package.json是包的配置文件。</p><p>package.json</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">calc</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">main</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./calc/main.js</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">test</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">                                      </span><span style="color:#676E95;font-style:italic;">//项目名称（必须）</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">version</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">                                  </span><span style="color:#676E95;font-style:italic;">//项目版本（必须）</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">This is for study gulp project!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">    </span><span style="color:#676E95;font-style:italic;">//项目描述（必须）</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">homepage</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">                                      </span><span style="color:#676E95;font-style:italic;">//项目主页</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">repository</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">                                      </span><span style="color:#676E95;font-style:italic;">//项目资源库</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">git</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://github.com/xxxx</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">author</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">                                          </span><span style="color:#676E95;font-style:italic;">//项目作者信息</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">allcky</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">email</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">allcky@qq.com</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">license</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ISC</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">                                    </span><span style="color:#676E95;font-style:italic;">//项目许可协议</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">devDependencies</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">                                 </span><span style="color:#676E95;font-style:italic;">//项目开发依赖包</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">gulp</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">^3.8.11</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">gulp-less</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">^3.0.0</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">dependencies</span><span style="color:#89DDFF;">:{</span><span style="color:#F07178;">                                       </span><span style="color:#676E95;font-style:italic;">//项目生产依赖包</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><strong>Package.json 属性说明</strong></p><table><thead><tr><th>属性</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td>name</td><td style="text-align:left;">包名。规范定义它需要由小写的字母和数字组成, 可以包含 . _ - 但是不允许包含空格，包名必需是唯一的，以避免对外公布时产生重名冲突的误解。</td></tr><tr><td>version</td><td style="text-align:left;">包的版本号。一个语义化的版本号。<a href="https://semver.org/lang/zh-CN/" target="_blank" rel="noreferrer">查看详情</a></td></tr><tr><td>description</td><td style="text-align:left;">包的描述。</td></tr><tr><td>keywords</td><td style="text-align:left;">关键词数组, NPM 中主要用来做分类搜索</td></tr><tr><td>homepage</td><td style="text-align:left;">包的官网 url 。</td></tr><tr><td>author</td><td style="text-align:left;">包的作者姓名。</td></tr><tr><td>contributors</td><td style="text-align:left;">包的其他贡献者姓名。</td></tr><tr><td>devDependencies</td><td style="text-align:left;">开发环境依赖包列表。</td></tr><tr><td>dependencies</td><td style="text-align:left;">生产环境依赖包列表。如果依赖包没有安装，npm 会自动将依赖包安装在 node_module 目录下。</td></tr><tr><td>repository</td><td style="text-align:left;">包代码存放的地方的类型，可以是 git 或 svn，git 可在 Github 上。</td></tr><tr><td>main</td><td style="text-align:left;">main 字段是一个模块ID，它是一个指向你程序的主要项目。就是说，如果你包的名字叫 express，然后用户安装它，然后require(&quot;express&quot;)。</td></tr><tr><td>keywords</td><td style="text-align:left;">关键字</td></tr></tbody></table><p><strong>符合CommonJS规范的包</strong></p><p>Node.js 的包是一个目录，其中包含一个 JSON 格式的包说明文件 package.json。严格符 合 CommonJS 规范的包应该具备以下特征:</p><table><thead><tr><th>文件类型</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td>package.json</td><td style="text-align:left;">必须在包的顶层目录下</td></tr><tr><td>二进制文件</td><td style="text-align:left;">应该在 bin 目录下</td></tr><tr><td>JavaScript</td><td style="text-align:left;">应该在 lib 目录下</td></tr><tr><td>文档</td><td style="text-align:left;">应该在 doc 目录下</td></tr><tr><td>单元测试</td><td style="text-align:left;">应该在 test 目录下</td></tr></tbody></table><p>Node.js 对包的要求并没有这么严格，只要顶层目录下有 package.json，并符合一些规范即可。当然为了提高兼容性，还是建议在制作包的时候，严格遵守 CommonJS 规范。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;"> ├── bin</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">            # 存放命令行相关代码</span></span>
<span class="line"><span style="color:#A6ACCD;"> │</span></span>
<span class="line"><span style="color:#A6ACCD;"> ├── src</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">            # 开发目录</span></span>
<span class="line"><span style="color:#A6ACCD;"> │</span></span>
<span class="line"><span style="color:#A6ACCD;"> ├── doc</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">            # 存放文档</span></span>
<span class="line"><span style="color:#A6ACCD;"> │</span></span>
<span class="line"><span style="color:#A6ACCD;"> ├── lib</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">            # 存放API相关代码</span></span>
<span class="line"><span style="color:#A6ACCD;"> │</span></span>
<span class="line"><span style="color:#A6ACCD;"> ├── node_modules</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">   # 存放三方包</span></span>
<span class="line"><span style="color:#A6ACCD;"> │</span></span>
<span class="line"><span style="color:#A6ACCD;"> ├── tests</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">          # 存放测试用例</span></span>
<span class="line"><span style="color:#A6ACCD;"> │</span></span>
<span class="line"><span style="color:#A6ACCD;"> ├── package</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">json    # 元数据文件</span></span>
<span class="line"><span style="color:#A6ACCD;"> │</span></span>
<span class="line"><span style="color:#A6ACCD;"> └── README</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">md       # 说明文件</span></span>
<span class="line"></span></code></pre></div><h2 id="npm使用" tabindex="-1">NPM使用 <a class="header-anchor" href="#npm使用" aria-hidden="true">#</a></h2><blockquote><p>Node Package Manager 简称NPM，是Nodejs的包管理器。</p></blockquote><p><strong>包管理器</strong> 又称软件包管理系统，它是在电脑中自动安装、配制、卸载和升级软件包的工具组合，在各种系统软件和应用软件的安装管理中均有广泛应用。对于我们业务开发也很受益，相同的东西不必重复去造轮子。</p><p><strong>NPM介绍</strong></p><p>npm是由三个不同的部分组成：</p><ul><li><strong>网站</strong>：网站是用户发现包的主要工具</li><li><strong>注册表</strong>：注册表是一个关于包信息的大型数据库</li><li><strong>CLI</strong>：CLI则告诉开发者如何在注册表上发布包或者下载包</li></ul><p><strong>NPM使用场景</strong></p><p>NPM是随同Nodejs一起安装的包管理工具，能解决NodeJS代码部署上的很多问题，常见的使用场景有以下几种：</p><ul><li>允许用户从NPM服务器下载开发者开发的第三方包到本地使用。</li><li>允许用户从NPM服务器下载并安装开发者开发的命令行程序到本地使用。</li><li>允许用户将自己开发的包或命令行程序上传到NPM服务器供其他开发者使用。</li></ul><p><strong>npm的常用命令</strong></p><table><thead><tr><th>序号</th><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>1</td><td>npm -v</td><td>显示版本，检查npm 是否正确安装。</td></tr><tr><td>2</td><td>npm install &lt;包名&gt;</td><td>安装指定模块</td></tr><tr><td>3</td><td>npm install -g &lt;包名&gt;</td><td>全局安装指定模块（一般安装命令行工具）</td></tr><tr><td>4</td><td>npm uninstall &lt;包名&gt;</td><td>卸载指定的模块</td></tr><tr><td>5</td><td>npm rebuild</td><td>重新安装所有模块</td></tr><tr><td>6</td><td>npm rebuild &lt;包名&gt;</td><td>重新安装模块</td></tr><tr><td>7</td><td>npm list</td><td>列出已安装模块</td></tr><tr><td>8</td><td>npm search &lt;包名&gt;</td><td>搜索指定的NPM包</td></tr><tr><td>9</td><td>npm show &lt;包名&gt;</td><td>显示模块详情</td></tr><tr><td>10</td><td>npm update</td><td>升级当前目录下的项目的所有模块</td></tr><tr><td>11</td><td>npm update &lt;包名&gt;</td><td>升级当前目录下的项目的指定模块</td></tr><tr><td>12</td><td>npm update -g &lt;包名&gt;</td><td>升级全局安装的指定模块</td></tr><tr><td>13</td><td>npm init （npm init -y）</td><td>通过向导的方式生成package.json文件（npm init -y就是一键生成）</td></tr><tr><td>14</td><td>npm adduser</td><td>添加用户 在npm官网注册的账号</td></tr><tr><td>15</td><td>npm publish</td><td>可以发布自己制作的包到NPM服务器</td></tr><tr><td>16</td><td>npm unpublish &lt;包名&gt;@&lt;版本号（x.y.z）&gt;</td><td>可以撤销发布自己发布过的某个版本包。</td></tr><tr><td>17</td><td>npm root</td><td>查看当前目录模块的安装路径</td></tr><tr><td>18</td><td>npm root -g</td><td>查看全局安装模块的安装路径</td></tr></tbody></table><p><strong>NPM服务器发布包</strong></p><p>第一次使用NPM发布自己的包需要在<a href="https://www.npmjs.com/" target="_blank" rel="noreferrer">npmjs.com</a>注册一个账号</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ npm adduser                # 添加用户  在npm官网注册的账号</span></span>
<span class="line"><span style="color:#A6ACCD;">Username: allcky             # 用户名</span></span>
<span class="line"><span style="color:#A6ACCD;">Password:                    # 密码</span></span>
<span class="line"><span style="color:#A6ACCD;">Email: (this IS public) allcky@qq.com</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>查看当前使用的用户</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ npm whoami</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>npm登录</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">npm login</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>发布包</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ npm publish              # 可以发布自己制作的包到NPM服务器</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>撤销发布</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ npm unpublish &lt;包名&gt;@&lt;版本号x.y.z&gt; # 可以撤销发布自己发布过的某个版本包。</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p><strong>全局安装与本地安装</strong></p><p><strong>本地安装</strong></p><blockquote><p>默认情况下，NPM安装指定包默认会安装到本地。本地安装指的是包安装在当前目录中node_modules文件夹中。本地安装的包都可以通过require()方法进行访问。</p></blockquote><p><strong>全局安装</strong></p><blockquote><p>全局安装包都存储在系统目录中。我们可以在nodejs的CLI(命令行界面)使用，但是不能直接使用require()方法进行访问。</p></blockquote><p><strong>--save 和 --save-dev 的区别</strong></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;"># 保存至dependencies下</span></span>
<span class="line"><span style="color:#A6ACCD;">$ npm install </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">包名</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">save</span></span>
<span class="line"><span style="color:#A6ACCD;">$ npm install </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">包名</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">S</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"># 保存至devDependencies下</span></span>
<span class="line"><span style="color:#A6ACCD;">$ npm install </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">包名</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">save</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">dev</span></span>
<span class="line"><span style="color:#A6ACCD;">$ npm install </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">包名</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"></span></code></pre></div><table><thead><tr><th>package属性</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td>dependencies</td><td style="text-align:left;">该属性下记录的是项目在运行时必须依赖的插件，常见的例如react jquery等，即及时项目打包好了、上线了，这些也是需要用的，否则程序无法正常执行。</td></tr><tr><td>devDependencies</td><td style="text-align:left;">下记录的是项目在开发过程中使用的插件，例如这里我们开发过程中需要使用webpack打包，而我在工作中使用fis3打包，但是一旦项目打包发布、上线了之后，webpack和fis3就都没有用了，可卸磨杀驴。</td></tr></tbody></table><p><strong>NPM源设置</strong></p><blockquote><p>npm全称Node Package Manager，是node.js的模块依赖管理工具。由于npm的源(服务器)在国外，所以国内用户使用起来各种不方便，尤其是下载包的速度非常慢。国内一些企业自己搭建了NPM的镜像源，通过访问镜像源可以提高访问速度。</p></blockquote><p><strong>命令设置NPM源</strong></p><p>查看当前 npm 源</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ npm config get registry</span></span>
<span class="line"><span style="color:#A6ACCD;"># http://registry.npmjs.org/</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>切换为 taobao 源</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ npm config set registry=https://registry.npm.taobao.org</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>切换为 npm 官方源 在 <code>npm publish</code> 的时候 需要切换回 npm 源</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ npm config set registry=http://registry.npmjs.org</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p><strong>nrm工具设置NPM源</strong></p><blockquote><p>nrm 是一个管理 npm 源的工具。</p></blockquote><p>全局安装 nrm</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ npm i nrm -g</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>nrm ls 列出来现在已经配置好的所有的原地址</p><p>查看当前 nrm 内置的几个 npm 源的地址：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ nrm ls</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>nrm use是切换到哪个源上</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ nrm use npm</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>nrm test测试源的响应时间，可以作为使用哪个源的参考</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ nrm test</span></span>
<span class="line"></span></code></pre></div>`,139),p=[o];function e(c,r,y,d,i,D){return a(),n("div",null,p)}const A=s(t,[["render",e]]);export{C as __pageData,A as default};
